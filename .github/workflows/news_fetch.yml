# .github/workflows/news_fetch.yml á€á€½á€„á€º á€¡á€…á€¬á€¸á€‘á€­á€¯á€¸á€›á€”á€º

name: Fetch and Save News by Category

on:
  schedule:
    # ğŸ“Œ á€™á€¼á€”á€ºá€™á€¬á€…á€¶á€á€±á€¬á€ºá€á€»á€­á€”á€º (MMT - UTC+6:30) á€€á€­á€¯ á€¡á€á€¼á€±á€á€¶á€á€±á€¬ á… á€€á€¼á€­á€™á€º
    - cron: "30 1 * * *" # 01:30 UTC = 8:00 AM MMT (General)
    - cron: "30 5 * * *" # 05:30 UTC = 12:00 PM MMT (Technology)
    - cron: "30 9 * * *" # 09:30 UTC = 4:00 PM MMT (World Politics)
    - cron: "30 13 * * *" # 13:30 UTC = 8:00 PM MMT (Business and Finance)
    - cron: "30 16 * * *" # 16:30 UTC = 11:00 PM MMT (Daily Summary)
  workflow_dispatch:

jobs:
  run-news-fetcher:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      - name: Install dependencies
        run: pip install requests gspread

      - name: Determine Category and Run Script
        id: run_script_step
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GOOGLE_SHEET_ID: ${{ secrets.GOOGLE_SHEET_ID }}
          GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
        run: |
          # á€œá€€á€ºá€›á€¾á€­ UTC á€”á€¬á€›á€®á€€á€­á€¯ á€šá€°á€á€¼á€„á€ºá€¸ (GitHub Actions á€›á€²á€· default time zone)
          CURRENT_HOUR=$(date -u +%H) 

          # Schedule á€¡á€œá€­á€¯á€€á€º Category á€á€á€ºá€™á€¾á€á€ºá€á€¼á€„á€ºá€¸ (á€™á€­á€”á€…á€º áƒá€ á€™á€¾á€¬á€á€¬ run á€™á€¾á€¬ á€–á€¼á€…á€ºá€á€²á€·á€¡á€á€½á€€á€º á€”á€¬á€›á€®á€€á€­á€¯á€•á€² á€…á€…á€ºá€†á€±á€¸á€á€Šá€º)
          if [ "$CURRENT_HOUR" == "01" ]; then
            CATEGORY="General" # 8:00 AM MMT
          elif [ "$CURRENT_HOUR" == "05" ]; then
            CATEGORY="Technology" # 12:00 PM MMT
          elif [ "$CURRENT_HOUR" == "09" ]; then
            CATEGORY="World Politics" # 4:00 PM MMT
          elif [ "$CURRENT_HOUR" == "13" ]; then
            CATEGORY="Business and Finance" # 8:00 PM MMT
          elif [ "$CURRENT_HOUR" == "16" ]; then
            CATEGORY="Daily Summary" # 11:00 PM MMT
          else
            # á€¡á€€á€šá€ºá á€¡á€á€»á€­á€”á€ºá€™á€€á€­á€¯á€€á€ºá€•á€«á€€áŠ á€šá€¬á€šá€®á€¡á€¬á€¸á€–á€¼á€„á€·á€º General á€€á€­á€¯ á€á€¯á€¶á€¸á€•á€«á€™á€Šá€º
            echo "::warning::Scheduled run time did not match a specific category hour. Using General."
            CATEGORY="General"
          fi

          echo "Running news fetcher for category: $CATEGORY"
          # category á€€á€­á€¯ python script á€á€­á€¯á€· argument á€¡á€–á€¼á€…á€º á€•á€­á€¯á€·á€œá€­á€¯á€€á€ºá€á€Šá€º
          python news_fetcher.py "$CATEGORY"
